<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<link rel="stylesheet" href="">
	<script src="jquery-1.12.4.js"></script>
</head>
<body>
<form id="myform" name="myform" action="your_url" method="post" enctype="multipart/form-data" >

    <div id="sendBefore">
         <p>上传视频</p>
        <input id="videoForm" type="file" name="videos[]" multiple= "multiple" />
    </div>  
<form>
<script>
	/**
	 * 1）如果整个页面有form表单在外面，你在里面再加form是不可行的。默认浏览器就会把你的form去掉了。只能动太添加，还有别的一个解决方案，可以不加form,创建formDate对象也是可以的

2）input file添加完了视频/图片时，第二次再添相同的名称的文件是不可以的。其实这也是为了安全考虑，解决方法是每次change时，把当前的vlaue清空了

需求是点击‘上传视频’安钮，出现上传加载监控条。成功之后截取视频弟一帧的图片展示出来。点击封面后在当前的页面播放查看。
	 */
	/**
	 * 1》查看七牛官网提供的上传地址。（此处有坑）默认提供的URL上传出错。返回一个别的URL拿到以后才可以上传成功

登陆七牛后台的一些设置拿到KEY。然后给到前端一个请求连接，拿到token。把token和当前的文件传给七牛，七牛会返回一个 name拿到以后根据 自己的域拼接成一个访问的视频地址即可，七年文档API访问地址如下： 
	 */
$('#videoForm').on("change",function(){
	// 获取上传的文件名字
	var fileVal = $(this).val();
	var fileName = fileVal.substring(fileVal.lastIndexOf("\\") + 1);

	// 判断浏览器
	var isIE = /msie/.test(navigator.userAgent) && !window.opera;

	var token = '';
	var fileSize = 0;

	// 兼容IE
	if(isIE && !this.files){
		// 获取上传文件的绝对路径
		var filePath = this.value;
		var fileSystem = new ActiveObject("Scripting.FileSystemObject");
		var file = fileSystem.GetFile(filePath);

		// 文件大小单位b
		fileSize = file.size;

	}else{
		// 其他浏览器
		fileSize = this.files[0].size;

	}

	var size = fileSize / 1024 / 1024;

	// 计算出M
	if(size>10){
		alert('视频大小不能超过10M');
		$("#videoForm").val();
		return ;
	}
})
// 上传视频时监控当前的进度和上传大小的代码：
$.ajax({
	url:'your_url',
	type:'GET',
	dataType:"json",
	async:'false'
}).done(function(res){
	token = res.youtoken;

	// 发送视频请求
	var formData = new FormData();
	var vistUrl = "you_vist_url";
	var fs = null;
	var fStota = null;

	// 必须的二个值当前的文件和你的token验证
	formData.append('file',$(#videoForm)[0].files[0]);
	formData.append('tojen',token);

	$.ajax({
		url:"上传地址",
		type:'POST',
		cache:false,
		data:formData,
		processData:false,
		dataType:"json",
		contentType:false,
		// 利用progress监控进度
		xhr:xhrOnProgress(function(e){
			var percent = Math.round(e.loaded * 100 / e.total) + "%";
			$('#loadingBar').find('span').css('width',percent);
			$('#loadingBar span').find("strong").html(percent);
			$('#loadingBar span').find('i').html('已上传'+((e.loaded/1204/1024).toFixed(1))+'MB/'+((e.total/1024/1024).toFixed(1))+'MB');
		})
	}).done(function(res){
		// 拼接返回的视频地址
		$(".v-box").find('img').attr('src',vistUrl+res.hash+'?vframe/jpg/offset/1').show();
		$('#videoForm').val('');   
	}).fail(function(res){
		console.log(res);
	})
}).fail(function(res){
	console.log(res);
})
</script>	
</body>
</html>